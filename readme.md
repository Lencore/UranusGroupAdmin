# Шаблон бота

## Структура

- dto - общие для всех пакетов (папок) модели данных, например конфиг, константы и тп
- endpoint - точки входа для обработки запросов (поллинг, крон, вебхуки и тп)
- gateway - взаимодействие с внешними сервисами (базы данных, стореджи, апи и тп)
- gateway/database - тут лежит коннектор к базе и упрощенные методы для работы с ней
- gateway/redis - тут лежит коннектор к редису и упрощенные методы для работы с ним (нужно сделать)
- gateway/telegram - тут лежит общий коннектор к телеграму для доступа во всех слоях (в кроне и полинге)
- usecase - бизнес логика (сервисы, обработчики и тп)
- usecase/telegram/telegram_constructor.go - главный конструктор. Включает в себя зависимые сервисы (база, редис, бот и тп) и регистрирует хендлеры в Run() методе
- usecase/telegram/handlers.go - сами хендлеры для команды и методов, в которых есть базовые свойства для обращения к базе и тп
- util - утилиты (логгер и прочее)

## База данных и модели
Используется ORM Gorm с автомиграцией. Модели базы лежат в gateway/database/models.go

Для автомиграции нужно чтобы все было прописано в конструкторе

```
err = db.AutoMigrate(
		&User{},
		&ДругаяМодель{},
		&ИТП{},
	)
```

### Логгер ZAP

Логгер доступен везде начиная с zap.L() и далее по методам. Пример использования:

```
logger := zap.L()
logger.Info("Hello, world!")
```

Подробнее в документации go zap (в гитхабе)

## Запуск и конфиг

Модель конфига в dto, файл конфига yml скопировать из config.sample.yml в config.yml

и запустить любым удобным способом, например go build и затем запустить бинарник